## Vue 常见优化手段

### 使用 key

对于循环生成的列表，应该给每项设置一个**稳定**且**唯一**的 key。这样在列表变动时，尽量少的变动元素。

### 使用冻结的对象

冻结的对象不会被响应化。
对于一些不会再变动的数据。

## vue3 效率提升的点

1. 静态提示
   纯静态的元素节点，也就是没有动态绑定的内容，该节点会提升到 render 外部，提升复用。
2. 预字符串化
   当编译器遇到「大量连续」的静态内容，会直接将其编译成一个普通字符串节点。
3. 缓存事件处理函数
   vue2 里 createNode 创建节点时，如果节点有绑定事件函数，每次 createNode 都会重新创建函数。
   vue3 会将事件函数缓存下来，再次 createNode 时会复用。
4. block tree
   vue2 在新旧 VDOM diff 的时候，会一层一层、一个一个进行对比。但是因为有些节点本身是纯静态的，没有对比的必要。
   所以 vue3 里，会在根节点里记录子节点里所有动态节点，这个数就是 block tree，只进行有必要的对比。
5. patch flag
   vue3 在节点对比时，只对动态的内容进行对比，比如类名、内容、属性。在 createNode 时会记录下该节点的动态内容。

## vue 的 diff 算法

总体过程：组件创建和更新时，调用 render 函数会生成 vDOM，然后将新旧 vDOM 进行对比，找到差异点，更新到真实的 DOM 上。
vue 会采用「深度优先」、「逐层比较」的方式进行对比，这个过程就叫 diff。

1. 首先判断旧树是否存在，说明是第一次加载，直接便利新树生成一个真实 DOM，挂载到 elm 上。
2. 不存在，调用 patch 函数，进行新旧两棵树的对比，这其中有两个重要的核心目的：
   2.1 「对真实 DOM 的最小变动」
   2.2 「让新树的节点对应到合适的真实 DOM」

3. 判断两个节点是否相同时，是通过 「key」 和 「tag」 来判断的。
4. 判断子节点时，为两棵树的子节点列表都使用双指针，分别指向头尾，然后不断向中间靠拢。
